<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=600, height=400, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Jogo 2D Paisagem</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden;
    width: 600px; height: 400px;
    background: #222;
    color: #eee;
    font-family: Arial, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .screen {
    width: 600px; height: 400px;
    background: #333;
    padding: 15px;
    box-sizing: border-box;
    display: none;
    position: relative;
  }
  input, button {
    padding: 8px; margin: 5px 0; border-radius: 4px; border: none; font-size: 16px;
    width: 100%;
  }
  button {
    background: #555; color: #eee; cursor: pointer;
  }
  button:hover {
    background: #666;
  }
  #lobby-screen {
    display: flex; flex-direction: column; gap: 12px;
  }
  #buttons-row {
    display: flex; justify-content: space-between; gap: 10px;
  }
  #code-area {
    display: flex; flex-direction: column; width: 160px;
  }
  #inventory {
    margin-top: 10px; background: #444; padding: 10px; border-radius: 5px; height: 100px; overflow-y: auto;
  }
  #inventory button {
    width: auto; margin-right: 10px;
  }
  #game-screen {
    position: relative;
    height: 400px;
    width: 600px;
    background: #111;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }
  #weapon-left {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 80px;
    height: 80px;
    background: #222;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    user-select: none;
    z-index: 2;
  }
  #weapon-left img {
    max-width: 60px;
    max-height: 60px;
    pointer-events: none;
  }
  #game-canvas {
    margin-left: 100px;
    background: #222;
    border-radius: 10px;
    cursor: crosshair;
    flex-shrink: 0;
    width: 600px;
    height: 400px;
  }
  #score-display {
    position: absolute;
    top: 10px;
    right: 10px;
    color: #fff;
    font-size: 20px;
    font-weight: bold;
    user-select: none;
  }
  #btn-voltar {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
    background: #555;
    padding: 8px 12px;
    border-radius: 5px;
    color: white;
    border: none;
    cursor: pointer;
  }
  #btn-voltar:hover {
    background: #666;
  }
  #player-info {
    position: absolute;
    top: 0;
    right: 0;
    text-align: right;
    padding: 8px 12px;
    color: #eee;
    font-weight: bold;
    user-select: none;
  }
  #login-message, #code-message {
    margin-top: 6px;
    font-weight: bold;
  }
</style>
</head>
<body>

<!-- Tela login -->
<div id="login-screen" class="screen" style="display:block;">
  <h2>Login / Criar Conta</h2>
  <input type="text" id="username" placeholder="Nome de usuário" autocomplete="off" />
  <input type="password" id="password" placeholder="Senha" autocomplete="off" />
  <button id="btn-login">Logar</button>
  <button id="btn-create">Criar Conta</button>
  <p id="login-message"></p>
</div>

<!-- Tela Lobby -->
<div id="lobby-screen" class="screen">
  <h2>Lobby</h2>
  <button id="btn-play">Jogar</button>

  <div id="player-info">
    Jogador: <span id="player-name"></span><br />
    Pontos: <span id="player-points">0</span>
  </div>

  <div id="buttons-row">
    <div id="code-area">
      <input type="text" id="code-input" placeholder="Insira código" autocomplete="off" />
      <button id="btn-send-code">Enviar Código</button>
      <p id="code-message"></p>
    </div>

    <div id="settings-area">
      <h3>Configurações</h3>
      <div id="inventory">
        <strong>Inventário:</strong><br />
        <div id="weapon-list"></div>
      </div>
    </div>
  </div>
</div>

<!-- Tela do Jogo -->
<div id="game-screen" class="screen">
  <button id="btn-voltar">Voltar ao Menu</button>
  <div id="weapon-left">Nenhuma arma</div>
  <div id="score-display">Pontos: 0</div>
  <canvas id="game-canvas" width="600" height="400"></canvas>
</div>

<script>
  // Parte 1 do script: Login, contas, lobby, inventário, código

  const STORAGE_KEY = 'jogo2d_contas';
  let contas = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
  let userAtivo = null;

  // Elementos
  const loginScreen = document.getElementById('login-screen');
  const lobbyScreen = document.getElementById('lobby-screen');
  const gameScreen = document.getElementById('game-screen');
  const loginMessage = document.getElementById('login-message');
  const codeMessage = document.getElementById('code-message');
  const weaponLeft = document.getElementById('weapon-left');
  const weaponListDiv = document.getElementById('weapon-list');
  const scoreDisplay = document.getElementById('score-display');
  const playerNameSpan = document.getElementById('player-name');
  const playerPointsSpan = document.getElementById('player-points');
  const btnVoltar = document.getElementById('btn-voltar');

  const btnLogin = document.getElementById('btn-login');
  const btnCreate = document.getElementById('btn-create');
  const btnPlay = document.getElementById('btn-play');
  const btnSendCode = document.getElementById('btn-send-code');
  const inputUsername = document.getElementById('username');
  const inputPassword = document.getElementById('password');
  const inputCode = document.getElementById('code-input');

  const armasInfo = {
    'Normal': { damage: 1, fireRate: 400, img: null, imgSrc: 'https://i.imgur.com/ojS8Ksv.png' },
    'Pistola': { damage: 2, fireRate: 300, img: null, imgSrc: 'https://i.imgur.com/ciL6yLc.png' }
  };

  // Carrega imagens das armas
  function carregarImagens() {
    for (const nome in armasInfo) {
      let img = new Image();
      img.src = armasInfo[nome].imgSrc;
      armasInfo[nome].img = img;
    }
  }
  carregarImagens();

  function salvarContas() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(contas));
  }

  function criarConta(username, password) {
    if (contas[username]) return false;
    contas[username] = {
      password,
      inventory: ['Normal'],
      equipped: 'Normal',
      points: 0
    };
    salvarContas();
    return true;
  }

  function logar(username, password) {
    if (contas[username] && contas[username].password === password) {
      userAtivo = username;
      return true;
    }
    return false;
  }

  function atualizarInventario() {
    const inventario = contas[userAtivo].inventory;
    let equipado = contas[userAtivo].equipped;

    if (!equipado || !inventario.includes(equipado)) {
      equipado = 'Normal';
      contas[userAtivo].equipped = 'Normal';
      salvarContas();
    }

    weaponListDiv.innerHTML = '';

    if (inventario.length === 0) {
      weaponListDiv.innerHTML = '<em>Nenhuma arma</em>';
      return;
    }

    inventario.forEach(arma => {
      const btn = document.createElement('button');
      btn.textContent = arma;
      if (arma === equipado) btn.style.backgroundColor = '#4a4';
      btn.onclick = () => {
        contas[userAtivo].equipped = arma;
        salvarContas();
        atualizarInventario();
      };
      weaponListDiv.appendChild(btn);
    });
  }

  function atualizarPlayerInfo() {
    playerNameSpan.textContent = userAtivo || '';
    playerPointsSpan.textContent = contas[userAtivo]?.points || 0;
  }

  function mostrarTela(tela) {
    loginScreen.style.display = 'none';
    lobbyScreen.style.display = 'none';
    gameScreen.style.display = 'none';
    tela.style.display = 'block';
  }

  mostrarTela(loginScreen);

  btnCreate.onclick = () => {
    loginMessage.textContent = '';
    loginMessage.style.color = '#f44';
    const username = inputUsername.value.trim();
    const password = inputPassword.value;
    if (!username || !password) {
      loginMessage.textContent = 'Preencha nome e senha.';
      return;
    }
    if (criarConta(username, password)) {
      loginMessage.style.color = '#4f4';
      loginMessage.textContent = 'Conta criada! Agora faça login.';
    } else {
      loginMessage.textContent = 'Nome indisponível.';
    }
  };

  btnLogin.onclick = () => {
    loginMessage.textContent = '';
    loginMessage.style.color = '#f44';
    const username = inputUsername.value.trim();
    const password = inputPassword.value;
    if (!username || !password) {
      loginMessage.textContent = 'Preencha nome e senha.';
      return;
    }
    if (logar(username, password)) {
      loginMessage.style.color = '#4f4';
      loginMessage.textContent = 'Logado com sucesso!';
      inputUsername.value = '';
      inputPassword.value = '';
      atualizarInventario();
      atualizarPlayerInfo();
      mostrarTela(lobbyScreen);
    } else {
      loginMessage.textContent = 'Usuário ou senha incorretos.';
    }
  };

  btnSendCode.onclick = () => {
    codeMessage.textContent = '';
    codeMessage.style.color = '#f44';
    const code = inputCode.value.trim();
    if (code === '2026') {
      const inventario = contas[userAtivo].inventory;
      if (!inventario.includes('Pistola')) {
        inventario.push('Pistola');
        contas[userAtivo].equipped = 'Pistola';
        salvarContas();
        atualizarInventario();
        codeMessage.style.color = '#4f4';
        codeMessage.textContent = 'Código aceito! Pistola adicionada.';
      } else {
        codeMessage.style.color = '#4a4';
        codeMessage.textContent = 'Você já tem a pistola.';
      }
    } else {
      codeMessage.textContent = 'Código incorreto.';
    }
  };

  btnPlay.onclick = () => {
    if (!contas[userAtivo].equipped) {
      contas[userAtivo].equipped = 'Normal';
      salvarContas();
    }
    iniciarJogo();
    mostrarTela(gameScreen);
  };

  btnVoltar.onclick = () => {
    pararJogo();
    mostrarTela(lobbyScreen);
    atualizarInventario();
    atualizarPlayerInfo();
  };
</script>
