<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo 2D Completo</title>

<style>
body,html{
margin:0;
background:#222;
color:white;
font-family:Arial;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.screen{
display:none;
background:#333;
padding:15px;
width:600px;
height:400px;
position:relative;
flex-direction:column;
}

.screen.active{display:flex;}

input,button{
padding:8px;
margin:5px;
border:none;
border-radius:5px;
}

button{
background:#555;
color:white;
}

button:hover{background:#777;}

#game-screen{
width:600px;
height:640px;
background:#111;
}

#weapon-left{
position:absolute;
left:10px;
top:50%;
transform:translateY(-50%);
width:80px;
height:80px;
background:#222;
display:flex;
justify-content:center;
align-items:center;
border-radius:10px;
}

#game-canvas{
margin-left:100px;
background:#222;
border-radius:10px;
}

#score-display{
position:absolute;
top:10px;
right:10px;
font-size:20px;
}

#btn-voltar{
position:absolute;
top:40px;
left:10px;
}

#inventory button.selected{
background:#2ecc71;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-screen" class="screen active">
<h2>Login</h2>
<input id="username" placeholder="Usuário">
<input id="password" type="password" placeholder="Senha">
<button id="btn-login">Entrar</button>
<button id="btn-create">Criar Conta</button>
<p id="login-message"></p>
</div>

<!-- LOBBY -->
<div id="lobby-screen" class="screen">
<h2>Lobby</h2>
<button id="btn-play">Jogar</button>
<button id="btn-shop">Loja</button>

<p>Jogador: <span id="player-name"></span></p>
<p>Pontos: <span id="player-points"></span></p>

<input id="code-input" placeholder="Código">
<button id="btn-send-code">Enviar Código</button>
<p id="code-message"></p>

<div id="inventory"></div>
</div>

<!-- LOJA -->
<div id="shop-screen" class="screen">
<h2>Loja</h2>
<p>Pontos: <span id="shop-points"></span></p>
<button id="buy-pistol">Comprar Pistola (1500)</button>
<p id="shop-message"></p>
<button id="btn-shop-back">Voltar</button>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
<button id="btn-voltar">Voltar</button>
<div id="weapon-left"></div>
<div id="score-display"></div>
<canvas id="game-canvas" width="500" height="600"></canvas>
</div>

<script>

let contas = JSON.parse(localStorage.getItem("contas")) || {};
let user = null;

const armas={
Normal:{dmg:1,rate:400,img:"https://i.imgur.com/ojS8Ksv.png"},
Pistola:{dmg:2,rate:250,img:"https://i.imgur.com/ciL6yLc.png"}
};

const loginScreen=login-screen;
const lobbyScreen=lobby-screen;
const shopScreen=shop-screen;
const gameScreen=game-screen;

const canvas=document.getElementById("game-canvas");
const ctx=canvas.getContext("2d");

let tiros=[];
let caixas=[];
let pontos=0;
let arma="Normal";
let lastShot=0;

function show(scr){
[loginScreen,lobbyScreen,shopScreen,gameScreen].forEach(s=>s.classList.remove("active"));
scr.classList.add("active");
}

btn-create.onclick=()=>{
if(!username.value||!password.value) return;
if(contas[username.value]) return;
contas[username.value]={pass:password.value,points:0,inv:["Normal"]};
localStorage.setItem("contas",JSON.stringify(contas));
alert("Conta criada");
};

btn-login.onclick=()=>{
let c=contas[username.value];
if(c && c.pass===password.value){
user=username.value;
player-name.textContent=user;
player-points.textContent=c.points;
renderInv();
show(lobbyScreen);
}
};

btn-play.onclick=()=>{
pontos=contas[user].points;
arma=contas[user].inv[0];
show(gameScreen);
loop();
};

btn-voltar.onclick=()=>{
contas[user].points=pontos;
localStorage.setItem("contas",JSON.stringify(contas));
show(lobbyScreen);
};

btn-shop.onclick=()=>{
shop-points.textContent=contas[user].points;
show(shopScreen);
};

btn-shop-back.onclick=()=>show(lobbyScreen);

buy-pistol.onclick=()=>{
if(contas[user].inv.includes("Pistola")) return;
if(contas[user].points>=1500){
contas[user].points-=1500;
contas[user].inv.push("Pistola");
localStorage.setItem("contas",JSON.stringify(contas));
shop-message.textContent="Comprado!";
renderInv();
}
};

btn-send-code.onclick=()=>{
if(code-input.value==="2026"){
if(!contas[user].inv.includes("Pistola")){
contas[user].inv.push("Pistola");
renderInv();
}
}
};

function renderInv(){
inventory.innerHTML="";
contas[user].inv.forEach(a=>{
let b=document.createElement("button");
b.textContent=a;
b.onclick=()=>arma=a;
inventory.appendChild(b);
});
}

canvas.onclick=e=>{
let now=Date.now();
if(now-lastShot<armas[arma].rate) return;
lastShot=now;
tiros.push({x:50,y:canvas.height/2});
};

function loop(){
ctx.clearRect(0,0,500,600);

if(Math.random()<0.02){
caixas.push({x:400,y:0});
}

caixas.forEach(c=>{
c.y+=2;
ctx.fillStyle="red";
ctx.fillRect(c.x,c.y,40,40);
});

tiros.forEach(t=>{
t.x+=8;
ctx.fillStyle="yellow";
ctx.fillRect(t.x,t.y,6,4);
});

score-display.textContent="Pontos: "+pontos;
requestAnimationFrame(loop);
}

</script>

</body>
</html>
