<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Jogo 2D Completo</title>

<style>
body, html {
margin:0;
padding:0;
background:#222;
color:#eee;
font-family:Arial;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
overflow:hidden;
}

.screen{
display:none;
background:#333;
padding:15px;
flex-direction:column;
position:relative;
}

.screen.active{
display:flex;
}

input,button{
font-size:16px;
padding:8px;
margin:5px;
border-radius:5px;
border:none;
}

button{
background:#555;
color:white;
}

button:hover{background:#666;}

#player-info{
position:absolute;
top:10px;
right:10px;
text-align:right;
font-weight:bold;
}

/* ===== GAME ===== */

#game-screen{
width:820px;
height:340px;
background:#111;
display:flex;
position:relative;
border-radius:10px;
}

#weapon-left{
width:80px;
height:320px;
background:#222;
display:flex;
justify-content:center;
align-items:center;
}

#weapon-left img{
max-width:60px;
max-height:60px;
}

#game-canvas{
width:700px;
height:320px;
background:#222;
cursor:crosshair;
}

#right-blocker{
width:40px;
background:#0055ff;
}

/* HUD */

#btn-voltar{
position:absolute;
bottom:15px;
left:15px;
}

#score-display{
position:absolute;
bottom:15px;
right:15px;
font-size:20px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-screen" class="screen active">
<h2>Login / Criar Conta</h2>
<input id="username" placeholder="Nome">
<input id="password" type="password" placeholder="Senha">
<button id="btn-login">Logar</button>
<button id="btn-create">Criar Conta</button>
<p id="login-message"></p>
</div>

<!-- LOBBY -->
<div id="lobby-screen" class="screen">
<h2>Lobby</h2>
<button id="btn-play">Jogar</button>

<div id="player-info">
Jogador: <span id="player-name"></span><br>
Pontos: <span id="player-points">0</span>
</div>

<input id="code-input" placeholder="Código">
<button id="btn-send-code">Enviar Código</button>
<p id="code-message"></p>

<h3>Inventário</h3>
<div id="weapon-list"></div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
<button id="btn-voltar">Voltar</button>
<div id="weapon-left"></div>
<canvas id="game-canvas" width="700" height="320"></canvas>
<div id="right-blocker"></div>
<div id="score-display">Pontos: 0</div>
</div>

<script>
const STORAGE="contas";
let contas=JSON.parse(localStorage.getItem(STORAGE))||{};
let user=null;

const armas={
Normal:{dmg:1,rate:400,vida:4,img:"https://i.imgur.com/ojS8Ksv.png",scale:0.05},
Pistola:{dmg:2,rate:250,vida:2,img:"https://i.imgur.com/ciL6yLc.png",scale:0.03}
};

for(let a in armas){
let i=new Image();
i.src=armas[a].img;
armas[a].imgObj=i;
}

function salvar(){
localStorage.setItem(STORAGE,JSON.stringify(contas));
}

btn_create.onclick=()=>{};
const loginMsg=document.getElementById("login-message");

document.getElementById("btn-create").onclick=()=>{
let u=username.value.trim();
let p=password.value;
if(!u||!p)return loginMsg.textContent="Preencha tudo";
if(contas[u]) return loginMsg.textContent="Nome indisponível";
contas[u]={pass:p,inv:["Normal"],equip:"Normal",points:0};
salvar();
loginMsg.textContent="Conta criada!";
};

document.getElementById("btn-login").onclick=()=>{
let u=username.value.trim();
let p=password.value;
if(contas[u]&&contas[u].pass==p){
user=u;
show(lobby-screen);
updateLobby();
}else loginMsg.textContent="Erro login";
};

function show(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

function updateLobby(){
player-name.textContent=user;
player-points.textContent=contas[user].points;
weapon-list.innerHTML="";
contas[user].inv.forEach(w=>{
let b=document.createElement("button");
b.textContent=w;
b.onclick=()=>{
contas[user].equip=w;
salvar();
};
weapon-list.appendChild(b);
});
}

document.getElementById("btn-send-code").onclick=()=>{
if(code-input.value=="2026"){
if(!contas[user].inv.includes("Pistola")){
contas[user].inv.push("Pistola");
contas[user].equip="Pistola";
salvar();
updateLobby();
code-message.textContent="Pistola liberada!";
}
}else code-message.textContent="Código errado";
};

let canvas=document.getElementById("game-canvas");
let ctx=canvas.getContext("2d");

let arma={x:50,y:160,last:0,ang:0};
let tiros=[];
let caixas=[];
let pontos=0;

document.getElementById("btn-play").onclick=()=>{
show("game-screen");
startGame();
};

document.getElementById("btn-voltar").onclick=()=>{
show("lobby-screen");
updateLobby();
};

function startGame(){
pontos=contas[user].points;
score-display.textContent="Pontos: "+pontos;
setInterval(()=>{spawnBox()},2000);
loop();
}

function spawnBox(){
caixas.push({x:650,y:0,vida:4,speed:2});
}

canvas.onclick=e=>{
let r=canvas.getBoundingClientRect();
let x=e.clientX-r.left;
let y=e.clientY-r.top;
arma.ang=Math.atan2(y-arma.y,x-arma.x);
let a=armas[contas[user].equip];
if(Date.now()-arma.last>a.rate){
arma.last=Date.now();
tiros.push({x:arma.x,y:arma.y,ang:arma.ang});
}
};

function loop(){
ctx.clearRect(0,0,700,320);

let armaImg=armas[contas[user].equip].imgObj;
ctx.save();
ctx.translate(arma.x,arma.y);
ctx.rotate(arma.ang);
ctx.drawImage(armaImg,-20,-20,40,40);
ctx.restore();

tiros.forEach((t,i)=>{
t.x+=Math.cos(t.ang)*10;
t.y+=Math.sin(t.ang)*10;
ctx.fillStyle="yellow";
ctx.fillRect(t.x,t.y,6,3);

caixas.forEach((c,j)=>{
if(t.x>c.x && t.x<c.x+40 && t.y>c.y && t.y<c.y+40){
c.vida-=armas[contas[user].equip].dmg;
tiros.splice(i,1);
if(c.vida<=0){
caixas.splice(j,1);
pontos++;
contas[user].points=pontos;
salvar();
}
}
});
});

caixas.forEach((c,i)=>{
c.y+=c.speed;
ctx.fillStyle="red";
ctx.fillRect(c.x,c.y,40,40);
});

score-display.textContent="Pontos: "+pontos;

requestAnimationFrame(loop);
}
</script>

</body>
</html>
