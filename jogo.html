<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Jogo 2D Completo</title>

<style>
body, html {
  margin:0; padding:0;
  background:#222; color:#eee;
  font-family:Arial;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.screen{
  display:none;
  background:#333;
  padding:15px;
  box-sizing:border-box;
  flex-direction:column;
}

.screen.active{display:flex;}

input,button{
  font-size:16px;
  padding:8px;
  margin:5px 0;
  border-radius:5px;
  border:none;
}

button{
  background:#555;
  color:white;
  cursor:pointer;
}

button:hover{background:#666;}

#login-screen,#lobby-screen{
  width:600px;
  height:400px;
}

#game-screen{
  position:relative;
  background:#111;
  width:600px;
  height:640px;
}

#game-canvas{
  margin-left:100px;
  background:#222;
  border-radius:10px;
}

/* >>> MOVIDOS PARA BAIXO <<< */
#btn-voltar{
  position:absolute;
  top:40px;
  left:10px;
}

#score-display{
  position:absolute;
  top:40px;
  right:10px;
  font-size:20px;
}

/* INVENTARIO */
#inventory{
  background:#444;
  padding:10px;
  border-radius:6px;
  width:380px;
  height:120px;
  overflow-y:auto;
}

#inventory button.selected{
  background:#4a4;
}

#weapon-left{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  width:80px;
  height:80px;
  background:#222;
  border-radius:10px;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* BOTAO LOJA */
#btn-loja{
  margin-top:5px;
  background:#2277ff;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-screen" class="screen active">
<h2>Login / Criar Conta</h2>
<input id="username" placeholder="Usuário">
<input id="password" type="password" placeholder="Senha">
<button id="btn-login">Logar</button>
<button id="btn-create">Criar Conta</button>
<p id="login-message"></p>
</div>

<!-- LOBBY -->
<div id="lobby-screen" class="screen">
<h2>Lobby</h2>

<button id="btn-play">Jogar</button>

<p>Jogador: <span id="player-name"></span></p>
<p>Pontos: <span id="player-points">0</span></p>

<button id="btn-loja">Loja (Pistola 1500)</button>

<div id="inventory">
<b>Inventário</b><br>
<div id="weapon-list"></div>
</div>
</div>

<!-- JOGO -->
<div id="game-screen" class="screen">
<button id="btn-voltar">Voltar</button>
<div id="weapon-left">Nenhuma</div>
<div id="score-display">Pontos: 0</div>
<canvas id="game-canvas" width="500" height="600"></canvas>
</div>

<script>
const STORAGE="jogo2d_contas";
let contas=JSON.parse(localStorage.getItem(STORAGE))||{};
let user=null;

const armas={
 Normal:{damage:1,fireRate:400,scale:0.05,vida:4,imgSrc:"https://i.imgur.com/ojS8Ksv.png"},
 Pistola:{damage:2,fireRate:300,scale:0.03,vida:2,imgSrc:"https://i.imgur.com/ciL6yLc.png"}
};

for(let a in armas){
 let i=new Image();
 i.src=armas[a].imgSrc;
 armas[a].img=i;
}

function save(){localStorage.setItem(STORAGE,JSON.stringify(contas));}

function criar(u,p){
 if(contas[u])return false;
 contas[u]={pass:p,points:0,inventory:["Normal"],equipped:"Normal"};
 save();return true;
}

function login(u,p){
 if(contas[u] && contas[u].pass===p){
 user=u; return true;
 }
 return false;
}

const loginScreen=document.getElementById("login-screen");
const lobby=document.getElementById("lobby-screen");
const game=document.getElementById("game-screen");

function tela(t){
 loginScreen.classList.remove("active");
 lobby.classList.remove("active");
 game.classList.remove("active");
 t.classList.add("active");
}

function atualizarLobby(){
 document.getElementById("player-name").textContent=user;
 document.getElementById("player-points").textContent=contas[user].points;

 const list=document.getElementById("weapon-list");
 list.innerHTML="";
 contas[user].inventory.forEach(w=>{
  let b=document.createElement("button");
  b.textContent=w;
  if(w===contas[user].equipped) b.classList.add("selected");
  b.onclick=()=>{
   contas[user].equipped=w;
   save();
   atualizarLobby();
  }
  list.appendChild(b);
 });
}

/* LOJA */
document.getElementById("btn-loja").onclick=()=>{
 if(contas[user].inventory.includes("Pistola")){
  alert("Você já tem pistola");
  return;
 }
 if(contas[user].points>=1500){
  contas[user].points-=1500;
  contas[user].inventory.push("Pistola");
  save();
  atualizarLobby();
  alert("Pistola comprada!");
 }else{
  alert("Pontos insuficientes!");
 }
}

/* LOGIN */
btn-create.onclick=()=>{
 if(criar(username.value,password.value))
  login-message.textContent="Conta criada";
 else login-message.textContent="Já existe";
}

btn-login.onclick=()=>{
 if(login(username.value,password.value)){
  atualizarLobby();
  tela(lobby);
 }else login-message.textContent="Erro login";
}

/* JOGO */
const canvas=document.getElementById("game-canvas");
const ctx=canvas.getContext("2d");
let tiros=[],caixas=[],pontos=0;
let arma={x:60,y:300,angle:0,last:0};

function iniciar(){
 pontos=contas[user].points;
 document.getElementById("score-display").textContent="Pontos: "+pontos;
 caixas=[];
 setInterval(()=>{
  caixas.push({x:450,y:0,w:40,h:40,vida:armas.Normal.vida});
 },2000);
 loop();
}

canvas.onclick=e=>{
 let r=canvas.getBoundingClientRect();
 let mx=e.clientX-r.left;
 let my=e.clientY-r.top;
 arma.angle=Math.atan2(my-arma.y,mx-arma.x);
 let a=armas[contas[user].equipped];
 if(Date.now()-arma.last>a.fireRate){
  arma.last=Date.now();
  tiros.push({x:arma.x,y:arma.y,angle:arma.angle,damage:a.damage});
 }
}

function loop(){
 ctx.clearRect(0,0,500,600);

 caixas.forEach((c,i)=>{
  c.y+=2;
  ctx.fillStyle="red";
  ctx.fillRect(c.x,c.y,c.w,c.h);
  if(c.vida<=0){
   caixas.splice(i,1);
   pontos++;
   contas[user].points=pontos;
   save();
   document.getElementById("score-display").textContent="Pontos: "+pontos;
  }
 });

 tiros.forEach((t,i)=>{
  t.x+=Math.cos(t.angle)*10;
  t.y+=Math.sin(t.angle)*10;
  ctx.fillStyle="yellow";
  ctx.fillRect(t.x,t.y,6,3);

  caixas.forEach((c,j)=>{
   if(t.x>c.x&&t.x<c.x+c.w&&t.y>c.y&&t.y<c.y+c.h){
    c.vida-=t.damage;
    tiros.splice(i,1);
   }
  });
 });

 let img=armas[contas[user].equipped].img;
 ctx.save();
 ctx.translate(arma.x,arma.y);
 ctx.rotate(arma.angle);
 ctx.drawImage(img,-20,-20,40,40);
 ctx.restore();

 requestAnimationFrame(loop);
}

btn-play.onclick=()=>{
 tela(game);
 iniciar();
}

btn-voltar.onclick=()=>{
 tela(lobby);
 atualizarLobby();
}
</script>

</body>
</html>
