<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>Jogo 2D</title>

<style>
body,html{
margin:0;
background:#222;
color:white;
font-family:Arial;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
overflow:hidden;
}

.screen{
display:none;
background:#333;
padding:15px;
border-radius:10px;
flex-direction:column;
width:90vw;
max-width:750px;
}

.screen.active{display:flex;}

input,button{
margin:5px 0;
padding:10px;
font-size:16px;
border-radius:5px;
border:none;
}

button{background:#555;color:white;}

#game-area{
position:relative;
background:#111;
display:flex;
height:360px;
}

#weapon-left{
width:80px;
background:#222;
display:flex;
justify-content:center;
align-items:center;
}

#weapon-left img{
max-width:60px;
max-height:60px;
}

canvas{
background:#222;
}

#right-wall{
width:40px;
background:#0044ff;
}

#btnBack{
position:absolute;
bottom:10px;
left:10px;
}

#scoreGame{
position:absolute;
bottom:10px;
right:10px;
font-size:20px;
}

.inventory button.selected{
background:green;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen active">
<h2>Login / Criar Conta</h2>
<input id="user" placeholder="Usuário">
<input id="pass" type="password" placeholder="Senha">
<button id="loginBtn">Login</button>
<button id="createBtn">Criar Conta</button>
<p id="loginMsg"></p>
</div>

<!-- LOBBY -->
<div id="lobby" class="screen">
<h2>Lobby</h2>

<p>Jogador: <span id="playerName"></span></p>
<p>Pontos: <span id="playerPoints">0</span></p>

<button id="playBtn">Jogar</button>
<button id="shopBtn">Loja</button>

<input id="codeInput" placeholder="Código">
<button id="sendCode">Enviar Código</button>
<p id="codeMsg"></p>

<h3>Inventário</h3>
<div id="inventory" class="inventory"></div>
</div>

<!-- LOJA -->
<div id="shop" class="screen">
<h2>Loja</h2>
<p>Pontos: <span id="shopPoints"></span></p>
<button id="buyPistol">Comprar Pistola (1500)</button>
<p id="shopMsg"></p>
<button id="backLobby1">Voltar</button>
</div>

<!-- GAME -->
<div id="game" class="screen">

<div id="game-area">
<button id="btnBack">Menu</button>
<div id="weapon-left"></div>
<canvas id="canvas" width="600" height="360"></canvas>
<div id="right-wall"></div>
<div id="scoreGame">0</div>
</div>

</div>

<script>
let contas = JSON.parse(localStorage.getItem("contas")) || {};
let usuario = null;

const armas = {
Normal:{shots:4,rate:400,img:"https://i.imgur.com/ojS8Ksv.png"},
Pistola:{shots:2,rate:250,img:"https://i.imgur.com/ciL6yLc.png"}
};

let caixas=[];
let tiros=[];
let pontos=0;
let armaAtual="Normal";
let lastShot=0;

const login=document.getElementById("login");
const lobby=document.getElementById("lobby");
const shop=document.getElementById("shop");
const game=document.getElementById("game");

function show(t){
login.classList.remove("active");
lobby.classList.remove("active");
shop.classList.remove("active");
game.classList.remove("active");
t.classList.add("active");
}

document.getElementById("createBtn").onclick=()=>{
let u=user.value.trim();
let p=pass.value;
if(contas[u]){loginMsg.innerText="Nome indisponível";return;}
contas[u]={pass:p,inv:["Normal"],equip:"Normal",points:0};
localStorage.setItem("contas",JSON.stringify(contas));
loginMsg.innerText="Conta criada";
}

document.getElementById("loginBtn").onclick=()=>{
let u=user.value.trim();
let p=pass.value;
if(contas[u]&&contas[u].pass===p){
usuario=u;
updateLobby();
show(lobby);
}else loginMsg.innerText="Erro login";
}

function updateLobby(){
playerName.innerText=usuario;
playerPoints.innerText=contas[usuario].points;
inventory.innerHTML="";
contas[usuario].inv.forEach(w=>{
let b=document.createElement("button");
b.innerText=w;
if(w===contas[usuario].equip)b.classList.add("selected");
b.onclick=()=>{
contas[usuario].equip=w;
save();
updateLobby();
}
inventory.appendChild(b);
});
}

function save(){
localStorage.setItem("contas",JSON.stringify(contas));
}

sendCode.onclick=()=>{
if(codeInput.value==="2026"){
if(!contas[usuario].inv.includes("Pistola")){
contas[usuario].inv.push("Pistola");
save();
updateLobby();
codeMsg.innerText="Pistola ganha!";
}else codeMsg.innerText="Já tem.";
}else codeMsg.innerText="Código errado";
}

shopBtn.onclick=()=>{
shopPoints.innerText=contas[usuario].points;
shopMsg.innerText="";
show(shop);
}

backLobby1.onclick=()=>show(lobby);

buyPistol.onclick=()=>{
if(contas[usuario].inv.includes("Pistola")){
shopMsg.innerText="Já possui";
return;
}
if(contas[usuario].points>=1500){
contas[usuario].points-=1500;
contas[usuario].inv.push("Pistola");
contas[usuario].equip="Pistola";
save();
shopMsg.innerText="Comprado!";
}else shopMsg.innerText="Sem pontos";
}

playBtn.onclick=()=>{
armaAtual=contas[usuario].equip||"Normal";
pontos=contas[usuario].points;
scoreGame.innerText=pontos;
startGame();
show(game);
}

btnBack.onclick=()=>{
contas[usuario].points=pontos;
save();
updateLobby();
show(lobby);
}

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function startGame(){
caixas=[];
tiros=[];
setInterval(()=>{spawnBox()},2000);
requestAnimationFrame(loop);
}

function spawnBox(){
caixas.push({x:550,y:0,hp:armas.Normal.shots});
}

canvas.onclick=e=>{
let now=Date.now();
if(now-lastShot<armas[armaAtual].rate)return;
lastShot=now;
tiros.push({x:40,y:180});
}

function loop(){
ctx.clearRect(0,0,600,360);

caixas.forEach((b,i)=>{
b.y+=2;
ctx.fillStyle="red";
ctx.fillRect(b.x,b.y,40,40);

tiros.forEach((t,j)=>{
if(t.x>b.x&&t.x<b.x+40&&t.y>b.y&&t.y<b.y+40){
b.hp--;
tiros.splice(j,1);
if(b.hp<=0){
caixas.splice(i,1);
pontos++;
scoreGame.innerText=pontos;
}
}
});
});

tiros.forEach(t=>{
t.x+=10;
ctx.fillStyle="yellow";
ctx.fillRect(t.x,t.y,6,3);
});

requestAnimationFrame(loop);
}
</script>

</body>
</html>
