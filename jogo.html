<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Jogo 2D Completo</title>

<style>
body,html{
margin:0;
padding:0;
background:#222;
color:#eee;
font-family:Arial;
overflow:hidden;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.screen{
display:none;
background:#333;
padding:15px;
box-sizing:border-box;
flex-direction:column;
}

.screen.active{display:flex;}

input,button{
font-size:16px;
padding:8px;
margin:5px 0;
border-radius:5px;
border:none;
}

button{
background:#555;
color:white;
cursor:pointer;
}

button:hover{background:#666;}

#login-screen,#lobby-screen{
width:600px;
height:400px;
}

#player-info{
position:absolute;
top:10px;
right:10px;
font-weight:bold;
}

#buttons-row{
display:flex;
justify-content:space-between;
margin-top:10px;
}

#inventory{
background:#444;
padding:10px;
border-radius:6px;
width:380px;
height:100px;
overflow-y:auto;
}

#inventory button.selected{
background:#4a4;
}

#game-screen{
position:relative;
width:600px;
height:640px;
background:#111;
}

#weapon-left{
position:absolute;
left:10px;
top:50%;
transform:translateY(-50%);
width:80px;
height:80px;
background:#222;
display:flex;
align-items:center;
justify-content:center;
}

#weapon-left img{
max-width:60px;
max-height:60px;
}

#game-canvas{
margin-left:100px;
background:#222;
width:500px;
height:600px;
}

#score-display{
position:absolute;
top:10px;
right:10px;
font-size:20px;
}

#btn-voltar{
position:absolute;
top:10px;
left:10px;
}

</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-screen" class="screen active">
<h2>Login / Criar Conta</h2>
<input id="username" placeholder="Nome">
<input id="password" type="password" placeholder="Senha">
<button id="btn-login">Logar</button>
<button id="btn-create">Criar Conta</button>
<p id="login-message"></p>
</div>

<!-- LOBBY -->
<div id="lobby-screen" class="screen">
<h2>Lobby</h2>

<button id="btn-play">Jogar</button>
<button id="btn-loja">Loja</button>

<div id="player-info">
Jogador: <span id="player-name"></span><br>
Pontos: <span id="player-points">0</span>
</div>

<div id="buttons-row">

<div>
<input id="code-input" placeholder="Código">
<button id="btn-send-code">Enviar Código</button>
<p id="code-message"></p>
</div>

<div id="inventory">
<b>Inventário</b><br>
<div id="weapon-list"></div>
</div>

</div>
</div>

<!-- LOJA -->
<div id="shop-screen" class="screen">
<h2>Loja</h2>

<p>Pistola - 1500 Pontos</p>
<button id="btn-buy-pistol">Comprar Pistola</button>

<p id="shop-message"></p>

<button id="btn-back-lobby">Voltar</button>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">

<button id="btn-voltar">Voltar Menu</button>
<div id="weapon-left"></div>
<div id="score-display">Pontos: 0</div>

<canvas id="game-canvas" width="500" height="600"></canvas>

</div>

<script>

const STORAGE="jogo2d_contas";
let contas=JSON.parse(localStorage.getItem(STORAGE))||{};
let user=null;

const armas={
Normal:{dmg:1,rate:400,img:"https://i.imgur.com/ojS8Ksv.png",scale:0.05,life:4},
Pistola:{dmg:2,rate:300,img:"https://i.imgur.com/ciL6yLc.png",scale:0.03,life:2}
};

let imgs={};
for(let a in armas){
imgs[a]=new Image();
imgs[a].src=armas[a].img;
}

function save(){
localStorage.setItem(STORAGE,JSON.stringify(contas));
}

function show(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

/* LOGIN */

btnCreate.onclick=()=>{
let u=username.value.trim();
let p=password.value;
if(!u||!p)return;
if(contas[u]){login-message.textContent="Nome indisponível";return;}
contas[u]={password:p,inventory:["Normal"],equipped:"Normal",points:0};
save();
login-message.textContent="Conta criada!";
}

btnLogin.onclick=()=>{
let u=username.value.trim();
let p=password.value;
if(contas[u]&&contas[u].password==p){
user=u;
player-name.textContent=u;
player-points.textContent=contas[u].points;
loadInventory();
show("lobby-screen");
}else{
login-message.textContent="Erro login";
}
}

/* INVENTORY */

function loadInventory(){
weapon-list.innerHTML="";
contas[user].inventory.forEach(w=>{
let b=document.createElement("button");
b.textContent=w;
if(contas[user].equipped==w)b.classList.add("selected");
b.onclick=()=>{
contas[user].equipped=w;
save();
loadInventory();
}
weapon-list.appendChild(b);
});
}

/* CODE */

btn-send-code.onclick=()=>{
if(code-input.value=="2026"){
if(!contas[user].inventory.includes("Pistola")){
contas[user].inventory.push("Pistola");
contas[user].equipped="Pistola";
save();
loadInventory();
code-message.textContent="Pistola desbloqueada!";
}else{
code-message.textContent="Já possui.";
}
}else{
code-message.textContent="Código errado";
}
}

/* LOJA */

btn-loja.onclick=()=>show("shop-screen");

btn-back-lobby.onclick=()=>show("lobby-screen");

btn-buy-pistol.onclick=()=>{
if(contas[user].points>=1500){
if(!contas[user].inventory.includes("Pistola")){
contas[user].points-=1500;
contas[user].inventory.push("Pistola");
save();
player-points.textContent=contas[user].points;
loadInventory();
shop-message.textContent="Comprado!";
}else{
shop-message.textContent="Já possui!";
}
}else{
shop-message.textContent="Pontos insuficientes!";
}
}

/* GAME */

let canvas=document.getElementById("game-canvas");
let ctx=canvas.getContext("2d");

let caixas=[];
let tiros=[];
let pontos=0;
let lastFire=0;
let angle=0;

btn-play.onclick=()=>{
pontos=contas[user].points;
score-display.textContent="Pontos: "+pontos;
show("game-screen");
spawn();
loop();
}

btn-voltar.onclick=()=>{
contas[user].points=pontos;
save();
player-points.textContent=pontos;
show("lobby-screen");
}

canvas.onclick=(e)=>{
let r=canvas.getBoundingClientRect();
let mx=e.clientX-r.left;
let my=e.clientY-r.top;

let w=contas[user].equipped;
let a=armas[w];

angle=Math.atan2(my-300,mx-50);

let now=Date.now();
if(now-lastFire>a.rate){
lastFire=now;
tiros.push({x:50,y:300,ang:angle,dmg:a.dmg});
}
}

function spawn(){
setInterval(()=>{
caixas.push({x:460,y:0,life:4});
},2000);
}

function loop(){
ctx.clearRect(0,0,500,600);

caixas.forEach((c,i)=>{
c.y+=1;
ctx.fillStyle="red";
ctx.fillRect(c.x,c.y,40,40);
if(c.life<=0){
caixas.splice(i,1);
pontos++;
score-display.textContent="Pontos: "+pontos;
}
});

tiros.forEach((t,i)=>{
t.x+=Math.cos(t.ang)*8;
t.y+=Math.sin(t.ang)*8;
ctx.fillStyle="yellow";
ctx.fillRect(t.x,t.y,6,3);

caixas.forEach(c=>{
if(t.x>c.x&&t.x<c.x+40&&t.y>c.y&&t.y<c.y+40){
c.life-=t.dmg;
tiros.splice(i,1);
}
});
});

let gun=imgs[contas[user].equipped];
let s=armas[contas[user].equipped].scale;
ctx.save();
ctx.translate(50,300);
ctx.rotate(angle);
ctx.drawImage(gun,-gun.width*s/2,-gun.height*s/2,gun.width*s,gun.height*s);
ctx.restore();

requestAnimationFrame(loop);
}

</script>

</body>
</html>
